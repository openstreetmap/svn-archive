#!/bin/bash
#
# This script copies the eruby, ruby, html, css and images
# to the right places on www.openstreetmap

USER=$1
ROOT=/var/www/$USER

if [ "$1" = "" ]; then
  echo Usage: install_www some-user-name
  exit
fi


if [ "$USER" = "openstreetmap" ]; then
  echo "Won't delete things as we're deploying the real thing"
else
  echo "Deleting things"
  rm -rf $ROOT/*
  rm -rf ../bin
fi


# eruby
mkdir $ROOT/eruby
cp ruby/editing-interface/*.rhtml $ROOT/eruby/

# includes for eruby
mkdir $ROOT/eruby/include
cp ruby/editing-interface/include/*.rhtml $ROOT/eruby/include/

# css

mkdir $ROOT/css
cp html/css/style.css $ROOT/css/

# javascript

mkdir $ROOT/javascript

cp javascript/* $ROOT/javascript/

# images FIXME

mkdir $ROOT/images

cp html/images/somerights20.png $ROOT/images/
cp html/images/mag_map-120x120.png $ROOT/images/
cp html/images/map_up.png $ROOT/images/
cp html/images/map_down.png $ROOT/images/
cp html/images/map_left.png $ROOT/images/
cp html/images/map_right.png $ROOT/images/
cp html/images/map_zoomin.png $ROOT/images/
cp html/images/map_zoomout.png $ROOT/images/
cp html/images/bg.gif $ROOT/css/
cp html/images/left.gif $ROOT/css/
cp html/images/left_on.gif $ROOT/css/
cp html/images/right.gif $ROOT/css/
cp html/images/right_on.gif $ROOT/css/
cp html/images/tab_bottom.gif $ROOT/css/

# applet
cd java
ant

cp dist/OSMApplet.jar $ROOT/
cp lib/commons-codec-1.3.jar $ROOT/
cp dist/commons-httpclient-3.0-rc3.jar $ROOT/
cp dist/commons-logging.jar $ROOT/
cp dist/MinML2.jar $ROOT/
cp dist/core.jar $ROOT/
cp dist/plugin.jar $ROOT/

cd ..

# REST

mkdir -p $ROOT/ruby/api/0.2
mkdir -p $ROOT/ruby/api/osm
mkdir -p $ROOT/ruby/api/apache

cp ruby/api/*.rb $ROOT/ruby/api/0.2/
cp ruby/api/osm/*.rb $ROOT/ruby/api/osm/

ln -s $ROOT/ruby/api/osm $ROOT/ruby/osm

# Apache simple-auth for REST
cp ruby/api/apache/simple-auth.rb $ROOT/ruby/api/apache/

# RSS

cp ruby/rss/nodes.rb $ROOT/ruby/

# GPX RSS maker

mkdir -p ../bin

cp ruby/rss/gpx_files.rb ../bin/

# GPX parser

cp ruby/editing-interface/support/insert_gpx_files.rb ../bin/


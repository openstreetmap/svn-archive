#!/usr/bin/env ruby

require File.dirname(__FILE__) + '/../config/environment'

Session.find(:all, :conditions => ["updated_at < ?", 1.week.ago]).each do |session|
  begin
    if session[:user] and User.find(session[:user])
      session.destroy if session.updated_at < 1.month.ago
    else
      session.destroy
    end
  rescue Exception => ex
    puts "Invalid session #{session.session_id}: #{ex.to_s}"
    session.destroy
  end
end

UserToken.delete_all("expiry < NOW()")

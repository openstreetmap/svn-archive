<html>
<head>
<title>OpenStreetMap f&uuml;r Deutschland - Testversion </title>
<script type="text/javascript" src="javascript/OpenLayers.2.2.likegoogle.js"></script>
<script type="text/javascript" src="javascript/site.js"></script>

<link rel="stylesheet" type="text/css" href="css/style.css" />
</head>

<script type="text/javascript">
<!--
var map, layer;
var lon_url, lat_url, zoom_url;

var lon_default  = 8.5;
var lat_default  = 50;
var zoom_default = 9;
var layer_default = "mapnik";
var PI = 3.14159265358979323846;
var layer1;
var layer2;

lon_url = getURLParam('lon');
lat_url = getURLParam('lat');
zoom_url = getURLParam('zoom');
layer_url = getURLParam('layer');
if ( lon_url.length > 0 ){lon = parseFloat(lon_url);} else {lon = lon_default;}
if ( lat_url.length > 0 ){lat = parseFloat(lat_url);} else {lat = lat_default;}
if ( zoom_url.length > 0 ){zoom = parseInt(zoom_url);} else {zoom = zoom_default;}
if ( layer_url.length > 0 ){layer = layer_url;} else {layer = layer_default;}

lon_map = lon * 20037508.34 / 180;
lat_map = Math.log(Math.tan( (90 + lat) * PI / 360)) / (PI / 180);
lat_map = lat_map * 20037508.34 / 180;

function init() {
	OpenLayers.Util.onImageLoadError = function () {
		this.src = "http://www.openstreetmap.org/javascript/img/404.png";
	}

	map = new OpenLayers.Map ("map", {maxExtent: new OpenLayers.Bounds(-20037508.34,-20037508.34,20037508.34,20037508.34),
		maxZoomLevel: 18, maxResolution:156543, units:'meters', projection: "EPSG:41001", controls: []} );
	map.addControl(new OpenLayers.Control.PanZoomBar());
	map.addControl(new OpenLayers.Control.MouseDefaults());
	map.addControl (new OpenLayers.Control.LayerSwitcher());
	layer1 = new OpenLayers.Layer.LikeGoogle ("Mapnik", "http://tile.openstreetmap.org/mapnik/", {type:'png'});
	map.addLayer (layer1);
	layer2 = new OpenLayers.Layer.LikeGoogle( "Osmarender", "http://dev.openstreetmap.org/~ojw/Tiles/tile.php/", {type:'png'} );
	map.addLayer(layer2);
	if ( layer == "osmarender" )
	{	map.setBaseLayer(layer2);	}
	else
	{	map.setBaseLayer(layer1);	}
	map.setCenter (new OpenLayers.LonLat(lon_map, lat_map), zoom);
	map.events.register("moveend", map, function() {
	updatelinks();
	});
	document.find.query_name.defaultValue = getURLParam('query_name');
	document.find.query_name.select();
	document.find.query_name.focus();
	updatelinks();
}
function getURLParam(strParamName){
  var strReturn = "";
  var strHref = window.location.href;
  if ( strHref.indexOf("?") > -1 ){
    var strQueryString = strHref.substr(strHref.indexOf("?"));
    var aQueryString = strQueryString.split("&");
    for ( var iParam = 0; iParam < aQueryString.length; iParam++ ){
      if ( aQueryString[iParam].indexOf(strParamName + "=") > -1 ){
        var aParam = aQueryString[iParam].split("=");
        strReturn = aParam[1];
        break;
      }
    }
  }
  return strReturn;
}

function updatelinks() {
	var lonlat = map.getCenter();
	var lon = (lonlat.lon / 20037508.34) * 180;
	var lat = (lonlat.lat / 20037508.34) * 180;
	var PI = 3.14159265358979323846;
	lat = 180/PI * (2 * Math.atan(Math.exp(lat * PI / 180)) - PI / 2);
	var zoom = map.getZoom(); // + 3;
	var lay = "&layer=";
	if ( this.map.layers[1] == this.map.baseLayer )
	{ lay += "osmarender"; }
	else
	{ lay += "mapnik"; }
	link.href = "/mapnik/index.html" + "?lat=" + lat + "&lon=" + lon + "&zoom=" + zoom + lay;
	document.all.current_lat.innerHTML = lat.toFixed(4);
	document.all.current_lon.innerHTML = lon.toFixed(4);
	document.all.current_zoom.innerHTML = zoom;
}

//-->
</script>

<body onload="init();">
<table border=0 width="99%" height="99%" id="main_table">
<tr>
<td></td>
<td height="30px" align="left">
	<ul id="tabnav">
	     <li> <a class="active" id="viewanchor" href="/index.html" title="view maps">View</a></li>
	     <li> <a style="font-style:italic" href="http://map.openstreetmap.de/full.html" title="Full Screen Map">Vollbild</a> </li>
	     <li> <a style="font-style:italic" href="http://www.openstreetmap.org/login.html" title="edit maps">Edit</a> </li>
	     <li> <a href="javascript:
		    	var e=map.getExtent(); 
		    	var nelat = ( e.top / 20037508.34) * 180, 
		    	nelon = ( e.right / 20037508.34) * 180, 
			swlat = ( e.bottom / 20037508.34) * 180, 
			swlon = ( e.left / 20037508.34) * 180, 
			PI = 3.14159265358979323846; 
			nelat = 180/PI * (2 * Math.atan(Math.exp(nelat * PI / 180)) - PI / 2); 
			swlat = 180/PI * (2 * Math.atan(Math.exp(swlat * PI / 180)) - PI / 2); 
			void(alert('('+swlon+', '+nelat+', '+nelon+', '+swlat+')'));">
			Bounds</a></li>
		</ul>
</td>
</tr>

<tr>
<td width="200px" valign="top">

	<div id="logo">
			<center>
			<h1>OpenStreetMap</h1>
			<img src="images/mag_map-120x120.png" width="120" height="120"/><br/>
			<nobr><h2>The Free Wiki World Map</h2></nobr>
			</center>
	</div>
		
	<div id="intro">
			OpenStreetMap ist eine frei editierbare Karte der ganzen Welt. Sie wird von Leuten wie dir gemacht.
			<p/>
			OpenStreetMap erlaubt es die Daten anzuzeigen und zu editieren. 
			<p/>
			Dies ist der Deutsche OpennStreetMap Server. Um Daten zu editieren, m&uuml;ssen sie auf den 
			<A href="http://www.openstreetmap.org/">Englischen Hauptserver</a> wechseln.
	</div>
	<div>
		      <center>
		      <a href="http://creativecommons.org/licenses/by-sa/2.0/"><img src="images/somerights20.png" border="0"></a>
		      </center>
	</div>
	<div>
	</div>
		<BR>
		&nbsp;Zoom: <span ID="current_zoom">?</span><BR>
		&nbsp;Latitude: <span ID="current_lat"> ?</span><BR>
		&nbsp;Longitude: <span ID="current_lon"> ?</span><BR>
		&nbsp;<a class="active" id="link" href="/index.html">Permalink</a><BR>
		<FORM METHOD="GET" ACTION="http://www.zimmerheimer.de/osm_query/" NAME="find">
			&nbsp;<INPUT TYPE="text" NAME="query_name" VALUE=""><BR>
			&nbsp;<INPUT TYPE="submit" VALUE="Find Place">
			<INPUT TYPE="hidden" NAME="map_url" VALUE="http://map.openstreetmap.de/ralf.html">
		</FORM>
	</div>
</td>
<td>
	<div style="width:100%; height:100%; border: 1px solid black;z-index: 200" id="map">

  </div>
</td>
</tr>
</table>

<script type="text/javascript">
	if ((lat != undefined) && (lon != undefined) && (zoom != undefined)) {
		updatelinks(lon,lat,zoom);
	}
</script>

</body>
</html>

